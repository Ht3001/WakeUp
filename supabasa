-- Tabla de perfiles con roles
CREATE TABLE profiles (
  id uuid PRIMARY KEY REFERENCES auth.users(id),
  role text DEFAULT 'user'
);

-- Tabla de preguntas
CREATE TABLE questions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  text text NOT NULL,
  category text,
  is_premium boolean DEFAULT false
);

-- Relaci√≥n usuario-pregunta
CREATE TABLE user_questions (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid REFERENCES auth.users ON DELETE CASCADE,
  question_id uuid REFERENCES questions ON DELETE CASCADE,
  answered_at timestamp with time zone DEFAULT now(),
  UNIQUE(user_id, question_id)
);

-- Logros
CREATE TABLE achievements (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  title text NOT NULL,
  description text,
  threshold int
);

-- Logros desbloqueados por usuario
CREATE TABLE user_achievements (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id uuid REFERENCES auth.users ON DELETE CASCADE,
  achievement_id uuid REFERENCES achievements ON DELETE CASCADE,
  unlocked_at timestamp with time zone DEFAULT now(),
  UNIQUE(user_id, achievement_id)
);